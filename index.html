<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lost in Translation ğŸŒ | SongrÃ¤tsel</title>

<!-- ğŸŒ Social Preview -->
<meta property="og:title" content="Lost in Translation ğŸŒ â€“ Das Ãœbersetzungs-RÃ¤tselspiel" />
<meta property="og:description" content="Errate den Song anhand seiner Ãœbersetzung! Du hast 3 Versuche â€“ halte deinen Streak und sammle Punkte. ğŸ”¥" />
<meta property="og:image" content="https://www.lostintranslation.site/icon.png" />
<meta property="og:url" content="https://www.lostintranslation.site" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="theme-color" content="#007aff" />

<link rel="icon" type="image/png" href="icon.png" />

<style>
:root {
  --bg: #f3f6fb;
  --card: #ffffffcc;
  --muted: #6b7280;
  --accent: #007aff;
  --success: #16a34a;
  --danger: #ef4444;
  --glass-border: rgba(255, 255, 255, 0.6);
  --radius: 16px;
  --shadow: 0 8px 30px rgba(18, 25, 40, 0.08);
}

[data-theme="dark"] {
  --bg: #0e1118;
  --card: #1b1f27;
  --muted: #9ba3b3;
  --accent: #4cb2ff;
  --success: #22c55e;
  --danger: #f87171;
  --glass-border: rgba(255, 255, 255, 0.08);
  --shadow: 0 6px 25px rgba(0, 0, 0, 0.7);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, Segoe UI, Roboto, Arial;
  background: var(--bg);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 30px;
  overflow: auto;
  transition: background 0.3s ease;
}

.frame {
  max-width: 900px;
  width: 100%;
  background: var(--card);
  border-radius: 22px;
  padding: 26px;
  border: 1px solid var(--glass-border);
  backdrop-filter: blur(10px) saturate(140%);
  box-shadow: var(--shadow);
  transition: background 0.3s ease, box-shadow 0.3s ease;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 16px;
}

h1 {
  font-size: 24px;
  display: flex;
  align-items: center;
  gap: 8px;
}

h1 img {
  width: 28px;
  height: 28px;
}

p.sub {
  color: var(--muted);
  font-size: 13px;
}

button {
  cursor: pointer;
  border: none;
  border-radius: 10px;
  font-weight: 600;
}

.btn {
  padding: 9px 12px;
  transition: 0.2s;
}

.primary {
  background: linear-gradient(90deg, var(--accent), #63b6ff);
  color: #fff;
}

.primary:hover {
  opacity: 0.9;
}

.ghost {
  background: transparent;
  color: var(--muted);
}

main {
  display: flex;
  flex-wrap: wrap;
  gap: 18px;
}

.card {
  flex: 2;
  min-width: 300px;
  padding: 14px;
  border: 1px solid var(--glass-border);
  border-radius: 14px;
  background: var(--card);
}

.side {
  flex: 1;
  min-width: 260px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.text-area {
  font-family: ui-monospace, Menlo, monospace;
  white-space: pre-wrap;
  height: 320px;
  overflow: auto;
  padding: 10px;
  font-size: 15px;
  border-radius: 10px;
  background: transparent;
  border: 1px dashed rgba(0, 0, 0, 0.1);
  color: inherit;
}

[data-theme="dark"] .text-area {
  border-color: rgba(255, 255, 255, 0.1);
}

.panel {
  background: var(--card);
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--glass-border);
}

input[type="text"] {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid rgba(0, 0, 0, 0.1);
  font-size: 15px;
  background: transparent;
  color: inherit;
}

[data-theme="dark"] input[type="text"] {
  border-color: rgba(255, 255, 255, 0.15);
}

.muted {
  color: var(--muted);
  font-size: 13px;
}

footer {
  margin-top: 14px;
  text-align: center;
  font-size: 13px;
  color: var(--muted);
}

.explainer {
  margin-bottom: 12px;
  font-size: 14px;
  color: var(--muted);
  line-height: 1.4;
}

@media (max-width: 860px) {
  main {
    flex-direction: column;
  }

  .text-area {
    height: 280px;
  }
}
</style>
</head>

<body>
<div class="frame" id="app" data-theme="light">
  <header>
    <div>
      <h1>
        <img src="icon.png" alt="Icon" />
        Lost in Translation ğŸŒ
      </h1>
      <p class="sub">Errate den Song aus der Ãœbersetzung â€“ halte deinen Streak und sammle Punkte!</p>
    </div>
    <div>
      <button class="btn ghost" id="themeBtn">ğŸŒ™</button>
    </div>
  </header>

  <div class="explainer">
    ğŸ¯ <b>SpielerklÃ¤rung:</b><br>
    Lies den Ã¼bersetzten Songtext und errate den Titel oder KÃ¼nstler!  
    Du hast <b>drei Versuche</b>. Wenn du richtig liegst, bekommst du einen Punkt fÃ¼r deinen Streak ğŸ”¥.  
    Du kannst Hinweise anzeigen, aber keine mehr, wenn du die LÃ¶sung gefunden hast.
  </div>

  <main>
    <section class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div class="muted">Datum: <span id="dateLabel"></span></div>
        <div class="muted">Status: <span id="statusText">ladeâ€¦</span></div>
      </div>
      <div id="translatedText" class="text-area">Songtext wird geladenâ€¦</div>
    </section>

    <aside class="side">
      <div class="panel">
        <div class="muted">Dein Tipp</div>
        <input id="guessInput" type="text" placeholder="Song oder KÃ¼nstler..." autocomplete="off" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn primary" id="guessBtn">Raten</button>
          <button class="btn ghost" id="revealBtn">ğŸ‘€ LÃ¶sung</button>
        </div>
        <div id="triesLeft" class="muted" style="margin-top:6px">Versuche Ã¼brig: 3</div>
        <div id="result" style="margin-top:10px;font-weight:700"></div>
      </div>

      <div class="panel">
        <div class="muted">ğŸ”¥ Streak</div>
        <div style="font-size:18px;font-weight:700;color:var(--accent)">
          Heute: <span id="streak">0</span> â€¢ Best: <span id="bestStreak">0</span>
        </div>
      </div>

      <div class="panel">
        <div class="muted">ğŸ’¡ Hinweis</div>
        <p id="hint" class="muted">Noch keine Hinweise</p>
        <button class="btn ghost" id="hintBtn" style="margin-top:8px">Tipp anzeigen</button>
      </div>
    </aside>
  </main>

  <footer>
    <small>Du hast 3 Versuche pro Tag. Errate die Ãœbersetzung und halte deinen Streak!</small>
  </footer>
</div>

<script>
async function loadGameFromJson() {
  const today = new Date().toISOString().slice(0, 10);
  const translatedTextEl = document.getElementById("translatedText");
  const statusText = document.getElementById("statusText");
  const dateLabel = document.getElementById("dateLabel");

  dateLabel.textContent = new Date().toLocaleDateString("de-DE");

  try {
    const res = await fetch("./data/song_of_the_day.json", { cache: "no-store" });
    if (!res.ok) throw new Error("Keine Datei gefunden");
    const j = await res.json();

    if (j.date !== today) {
      translatedTextEl.textContent = "Das heutige RÃ¤tsel wurde noch nicht generiert!";
      statusText.textContent = "Warte auf Update";
      return;
    }

    window.current = { artist: j.artist, title: j.title };
    translatedTextEl.textContent = j.translation || j.translated || j.lyrics || "Kein Text verfÃ¼gbar.";
    statusText.textContent = "Ãœbersetzung geladen ğŸ‡©ğŸ‡ª";
  } catch {
    translatedTextEl.textContent = "Fehler beim Laden der Datei.";
    statusText.textContent = "Fehler";
  }
}

const guessBtn = document.getElementById("guessBtn");
const revealBtn = document.getElementById("revealBtn");
const hintBtn = document.getElementById("hintBtn");
const themeBtn = document.getElementById("themeBtn");

const guessInput = document.getElementById("guessInput");
const resultEl = document.getElementById("result");
const hintEl = document.getElementById("hint");
const streakEl = document.getElementById("streak");
const bestStreakEl = document.getElementById("bestStreak");
const triesLeftEl = document.getElementById("triesLeft");

let streak = Number(localStorage.getItem("sr_streak") || 0);
let best = Number(localStorage.getItem("sr_bestStreak") || 0);
let tries = 3;
let solved = false;

streakEl.textContent = streak;
bestStreakEl.textContent = best;

function normalize(s) {
  return (s || "").toLowerCase().replace(/[^a-z0-9Ã¤Ã¶Ã¼ÃŸ ]/gi, "").trim();
}

function saveProgress(reset = false) {
  if (reset) streak = 0;
  else streak++;
  if (streak > best) best = streak;
  localStorage.setItem("sr_streak", streak);
  localStorage.setItem("sr_bestStreak", best);
  streakEl.textContent = streak;
  bestStreakEl.textContent = best;
}

guessBtn.addEventListener("click", () => {
  if (!window.current || solved || tries <= 0) return;
  const guess = normalize(guessInput.value);
  const a = normalize(window.current.artist);
  const t = normalize(window.current.title);

  if (guess.includes(a) || guess.includes(t)) {
    resultEl.style.color = "var(--success)";
    resultEl.textContent = `âœ… Richtig! ${window.current.artist} â€“ ${window.current.title}`;
    saveProgress(false);
    solved = true;
    guessBtn.disabled = true;
    guessInput.disabled = true;
    revealBtn.disabled = true;
    hintBtn.disabled = true;
  } else {
    tries--;
    triesLeftEl.textContent = `Versuche Ã¼brig: ${tries}`;
    if (tries <= 0) {
      resultEl.style.color = "var(--danger)";
      resultEl.textContent = "âŒ Keine Versuche mehr!";
      saveProgress(true);
      guessBtn.disabled = true;
      guessInput.disabled = true;
    } else {
      resultEl.style.color = "var(--danger)";
      resultEl.textContent = "âŒ Falsch â€“ versuchâ€™s nochmal!";
    }
  }
});

revealBtn.addEventListener("click", () => {
  if (!window.current || solved) return;
  resultEl.style.color = "var(--muted)";
  resultEl.textContent = `ğŸ‘€ LÃ¶sung: ${window.current.artist} â€“ ${window.current.title}`;
  saveProgress(true);
  guessBtn.disabled = true;
  guessInput.disabled = true;
  revealBtn.disabled = true;
  hintBtn.disabled = true;
});

hintBtn.addEventListener("click", () => {
  if (!window.current || solved) return;
  hintEl.textContent = `KÃ¼nstler beginnt mit "${window.current.artist[0]}".`;
});

themeBtn.addEventListener("click", () => {
  const app = document.getElementById("app");
  const cur = app.getAttribute("data-theme") === "dark" ? "light" : "dark";
  app.setAttribute("data-theme", cur);
  themeBtn.textContent = cur === "dark" ? "â˜€ï¸" : "ğŸŒ™";
});

loadGameFromJson();
</script>
</body>
</html>
