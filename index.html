<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lost in Translation üåç</title>

<meta property="og:title" content="Lost in Translation üåç ‚Äì Das Emoji-R√§tselspiel" />
<meta property="og:description" content="Errate den Song anhand der Emojis! Drei Versuche pro Tag ‚Äì halte deinen Streak! üî•" />
<meta property="og:image" content="https://www.lostintranslation.site/icon.png" />
<meta property="og:url" content="https://www.lostintranslation.site" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="theme-color" content="#007aff" />
<style>
:root {
  --bg: #f3f6fb;
  --card: #ffffffcc;
  --muted: #6b7280;
  --text: #1e293b;
  --accent: #007aff;
  --success: #16a34a;
  --danger: #ef4444;
  --highlight: #f59e0b;
  --radius: 16px;
  --shadow: 0 8px 30px rgba(18, 25, 40, 0.08);
  --glass-border: rgba(255,255,255,0.6);
}

[data-theme="dark"] {
  --bg: radial-gradient(circle at top left, #0a0e17, #05070d);
  --card: rgba(20, 25, 35, 0.9);
  --text: #e9eefb;
  --muted: #9ba3b0;
  --accent: #3b82f6;
  --success: #22c55e;
  --danger: #ef4444;
  --highlight: #facc15;
  --shadow: 0 8px 40px rgba(0, 0, 0, 0.8);
  --glass-border: rgba(255,255,255,0.05);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: "Inter", -apple-system, Segoe UI, Roboto, Arial;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 30px;
}

.frame {
  max-width: 900px;
  width: 100%;
  background: var(--card);
  border-radius: 22px;
  padding: 26px;
  border: 1px solid var(--glass-border);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px) saturate(140%);
}

/* --- Header --- */
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 20px;
}

header .left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.app-icon {
  width: 42px;
  height: 42px;
  border-radius: 12px;
  box-shadow: 0 0 10px rgba(59,130,246,0.4);
}

h1 {
  font-size: 22px;
  font-weight: 700;
  color: var(--text);
}

p.sub {
  color: var(--muted);
  font-size: 13px;
}

button {
  cursor: pointer;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  transition: all 0.2s ease;
}

.btn {
  padding: 9px 12px;
}

.primary {
  background: linear-gradient(90deg, var(--accent), #63b6ff);
  color: #fff;
}

.ghost {
  background: transparent;
  color: var(--muted);
}

.ghost:hover {
  color: var(--text);
}

main {
  display: flex;
  flex-wrap: wrap;
  gap: 18px;
}

.card {
  flex: 2;
  min-width: 300px;
  padding: 14px;
  border: 1px solid var(--glass-border);
  border-radius: 14px;
  background: var(--card);
}

.side {
  flex: 1;
  min-width: 260px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.text-area {
  font-family: ui-monospace, Menlo, monospace;
  white-space: pre-wrap;
  height: 320px;
  overflow: auto;
  padding: 10px;
  font-size: 30px;
  border-radius: 10px;
  background: transparent;
  border: 1px dashed rgba(255,255,255,0.1);
  color: var(--text);
}

.panel {
  background: var(--card);
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--glass-border);
}

input[type="text"] {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.08);
  color: var(--text);
  font-size: 15px;
}

input::placeholder {
  color: var(--muted);
}

.muted {
  color: var(--muted);
  font-size: 13px;
}

footer {
  margin-top: 14px;
  text-align: center;
  font-size: 13px;
  color: var(--muted);
}

/* --- Kontraststarke Streakanzeige --- */
.streak-display {
  color: var(--highlight);
  font-weight: 700;
  text-shadow: 0 0 6px rgba(250,204,21,0.4);
}

/* --- Buttons deaktiviert --- */
button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.explainer {
  margin-bottom: 12px;
  font-size: 14px;
  color: var(--muted);
  line-height: 1.4;
}

@media (max-width: 860px) {
  main {
    flex-direction: column;
  }

  .text-area {
    height: 280px;
  }
}
</style>
</head>

<body>
<div class="frame" id="app" data-theme="dark">
<header>
  <div class="left">
    <img src="icon.png" alt="App Icon" class="app-icon" />
    <div>
      <h1>Lost in Translation üåç</h1>
      <p class="sub">3 Versuche ‚Ä¢ Errate den Song anhand der Emojis ‚Ä¢ Halte deinen Streak!</p>
    </div>
  </div>
  <button class="btn ghost" id="themeBtn">‚òÄÔ∏è</button>
</header>

  <div class="explainer">
    üéØ <b>Spielerkl√§rung:</b><br>
    Beim √úbersetzen eines bekannten Songs ist etwas schief gelaufen, und nun sind nur noch Emojis da. Schau dir die Emojis an und errate, welchen Song sie darstellen!  
    Du hast <b>drei Versuche</b>, um den richtigen Titel oder K√ºnstler zu erraten.  
    Wenn du es richtig hast, steigt dein Streak üî• ‚Äì wenn nicht, f√§ngst du wieder bei 0 an.  
    Tipp: Die Emojis beschreiben meist den Titel oder die Stimmung des Songs üé∂
  </div>

  
<main>
  <section class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div class="muted">Datum: <span id="dateLabel"></span></div>
      <div class="muted">Status: <span id="statusText">lade‚Ä¶</span></div>
    </div>
    <div id="translatedText" class="text-area">Song-Emojis werden geladen‚Ä¶</div>
  </section>

  <aside class="side">
    <div class="panel">
      <div class="muted">Dein Tipp</div>
      <input id="guessInput" type="text" placeholder="Song oder K√ºnstler..." autocomplete="off" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn primary" id="guessBtn">Raten</button>
        <button class="btn ghost" id="revealBtn">üëÄ L√∂sung</button>
      </div>
      <div id="result" style="margin-top:10px;font-weight:700"></div>
      <div class="muted" style="margin-top:4px">Versuche √ºbrig: <span id="attemptsLeft">3</span></div>
    </div>

    <div class="panel">
      <div class="muted">üî• Streak</div>
      <div class="streak-display">Heute: <span id="streak">0</span> ‚Ä¢ Best: <span id="bestStreak">0</span></div>
    </div>

    <div class="panel">
      <div class="muted">üí° Hinweis</div>
      <p id="hint" class="muted">Noch keine Hinweise</p>
      <button class="btn ghost" id="hintBtn" style="margin-top:8px">Tipp anzeigen</button>
    </div>
  </aside>
</main>

<footer>
  <small>Errate den Song des Tages anhand der Emojis üéµ</small>
</footer>
</div>

<script>
async function loadGameFromJson() {
  const today = new Date().toISOString().slice(0, 10);
  const translatedTextEl = document.getElementById('translatedText');
  const statusText = document.getElementById('statusText');
  const dateLabel = document.getElementById('dateLabel');

  dateLabel.textContent = new Date().toLocaleDateString("de-DE");

  try {
    const res = await fetch('./data/song_of_the_day.json', { cache: 'no-store' });
    if (!res.ok) throw new Error("Keine Datei gefunden");
    const j = await res.json();

    if (j.date !== today) {
      translatedTextEl.textContent = "Das heutige R√§tsel wurde noch nicht generiert!";
      statusText.textContent = "Warte auf Update";
      return;
    }

    window.current = { artist: j.artist, title: j.title };
    translatedTextEl.textContent = j.translation || j.translated || j.lyrics || "Keine Emojis verf√ºgbar.";
    statusText.textContent = "Emojis geladen üá©üá™";

        // Wenn heute bereits geraten wurde ‚Üí sofort L√∂sung anzeigen
    const lastPlayed = localStorage.getItem("sr_lastPlayed");
    if (lastPlayed === today) {
      document.getElementById("result").textContent = `‚úÖ L√∂sung: ${j.artist} ‚Äì ${j.title}`;
      document.getElementById("result").style.color = "var(--success)";
      document.getElementById("guessBtn").disabled = true;
      document.getElementById("guessInput").disabled = true;
      document.getElementById("revealBtn").disabled = true;
      document.getElementById("hintBtn").disabled = true;
      statusText.textContent = "Heute schon gespielt ‚úÖ";
    }

  } catch (e) {
    translatedTextEl.textContent = "Fehler beim Laden der Datei.";
    statusText.textContent = "Fehler";
  }
}

const guessBtn = document.getElementById("guessBtn");
const revealBtn = document.getElementById("revealBtn");
const hintBtn = document.getElementById("hintBtn");
const themeBtn = document.getElementById("themeBtn");
const guessInput = document.getElementById("guessInput");
const resultEl = document.getElementById("result");
const hintEl = document.getElementById("hint");
const streakEl = document.getElementById("streak");
const bestStreakEl = document.getElementById("bestStreak");
const attemptsLeftEl = document.getElementById("attemptsLeft");
const statusText = document.getElementById("statusText");

let streak = Number(localStorage.getItem("sr_streak") || 0);
let best = Number(localStorage.getItem("sr_bestStreak") || 0);
let attempts = 3;
let solved = false;

streakEl.textContent = streak;
bestStreakEl.textContent = best;

// === TAGESPR√úFUNG: Hat der Spieler heute schon gespielt? ===
const today = new Date().toISOString().slice(0, 10);
const lastPlayed = localStorage.getItem("sr_lastPlayed");

if (lastPlayed === today) {
  solved = true;
  guessBtn.disabled = true;
  guessInput.disabled = true;
  revealBtn.disabled = true;
  hintBtn.disabled = true;
  statusText.textContent = "Heute schon gespielt ‚úÖ";
}

// === Hilfsfunktionen ===
function normalize(s) {
  return (s || "").toLowerCase().replace(/[^a-z0-9√§√∂√º√ü ]/gi, "").trim();
}

function saveProgress(reset = false) {
  if (reset) {
    streak = 0;
  } else {
    streak++;
    if (streak > best) best = streak;
  }
  localStorage.setItem("sr_streak", streak);
  localStorage.setItem("sr_bestStreak", best);
  streakEl.textContent = streak;
  bestStreakEl.textContent = best;
}

function endGame() {
  guessBtn.disabled = true;
  guessInput.disabled = true;
  revealBtn.disabled = true;
  hintBtn.disabled = true;
  localStorage.setItem("sr_lastPlayed", today);
}

// === Spiel-Logik ===
guessBtn.addEventListener("click", () => {
  if (!window.current || solved) return;
  const guess = normalize(guessInput.value);
  const a = normalize(window.current.artist);
  const t = normalize(window.current.title);

  attempts--;
  attemptsLeftEl.textContent = attempts;

  if (guess.includes(a) || guess.includes(t)) {
    resultEl.style.color = "var(--success)";
    resultEl.textContent = `‚úÖ Richtig! ${window.current.artist} ‚Äì ${window.current.title}`;
    saveProgress(false);
    solved = true;
    endGame();
  } else if (attempts > 0) {
    resultEl.style.color = "var(--danger)";
    resultEl.textContent = `‚ùå Falsch! Du hast noch ${attempts} Versuch${attempts === 1 ? "" : "e"}.`;
  } else {
    resultEl.style.color = "var(--danger)";
    resultEl.textContent = "‚ùå Keine Versuche mehr ‚Äì morgen wieder!";
    saveProgress(true);
    endGame();
  }
});

revealBtn.addEventListener("click", () => {
  if (!window.current || solved) return;
  resultEl.style.color = "var(--muted)";
  resultEl.textContent = `üëÄ L√∂sung: ${window.current.artist} ‚Äì ${window.current.title}`;
  saveProgress(true);
  solved = true;
  endGame();
});

hintBtn.addEventListener("click", () => {
  if (!window.current || solved) return;
  hintEl.textContent = `K√ºnstler beginnt mit "${window.current.artist[0]}".`;
});

themeBtn.addEventListener("click", () => {
  const app = document.getElementById("app");
  const cur = app.getAttribute("data-theme") === "dark" ? "light" : "dark";
  app.setAttribute("data-theme", cur);
  themeBtn.textContent = cur === "dark" ? "‚òÄÔ∏è" : "üåô";
});

loadGameFromJson();
</script>

</body>
</html>
